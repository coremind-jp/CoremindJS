<html>
<head>
    <link href="../html5reset-1.6.1.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="../manifest.js"></script>
    <script type="text/javascript" src="../coremind.js"></script>
</head>
<body>
    <script type="text/javascript">
    var _class = "cm.core.LoaderInterface";
    document.title = _class;
    cm.Class.load(
        _class,
        "cm.event.Event",
        "cm.loaderImpl.RequestGroup",
        function main()
        {
            var ajaxUrl = "http://coremind.jp/ajax.php";
            //var ajaxUrl = "http://coremind.jp/Sandbox/CoremindJS/test/sample.xml";
            //var ajaxUrl = "http://uhyohyohyo.sakura.ne.jp/javascript/13_1_test.cgi";
            //var ajaxUrl = "http://uhyohyohyo.sakura.ne.jp/javascript/13_1.html";
            this.progress = function(e, per)
            {
                //cm.log.d(e.type, per);
            };
            this.update = function(e, completeUrl)
            {
                cm.log.d(e.type, completeUrl);
                try {
                    document.body.appendChild(cm.loader.getCache(completeUrl));
                } catch(e) {}
            };
            this.complete = function(e, report)
            {
                var xhr = cm.loader.getCache(ajaxUrl);
                cm.log.d(e.type,
                    report.error.length,
                    report.timeout.length
                    ,"type:", xhr.responseType
                    ,"text:", xhr.responseText
                    //,"xml:", xhr.responseXML
                    //,"muji:", xhr.response
                    );
                var p = cm.dom.d.createElement("p");
                p.innerText = xhr.responseText;
                document.body.innerHTML = "";
                document.body.appendChild(p);
                cm.Class.getSnippetTemplate();
            };
            this.timeout = function(e, url)
            {
                cm.log.d(e.type, url);
            };
            this.error = function(e, url)
            {
                cm.log.d(e.type, url);
            };
            
            var _tempFileName = "./cle18-00";
            var _format = ".jpg";
            var _group = new cm.loaderImpl.RequestGroup();
            for(var i = 0, j = 10; i < j; i++)
            {
                _group.addRequire(_tempFileName + i + _format);
                if (i % 2 == 0)
                    _group.removeRequire(_tempFileName + i + _format);
            }
            _group.addRequire(ajaxUrl);
            cm.loader.templateOption.ajax.header["Content-Type"] = "application/xml; charset=utf-8";
            cm.loader.addRequestGroup(_group);
            
            _group.addEventListener(cm.event.Event.UPDATE, this, this.update);
            _group.addEventListener(cm.event.Event.PROGRESS, this, this.progress);
            _group.addEventListener(cm.event.Event.COMPLETE, this, this.complete);
            
            cm.loader.addEventListener(cm.event.Event.TIMEOUT, this, this.timeout);
            cm.loader.addEventListener(cm.event.Event.ERROR, this, this.error);
            setTimeout(function(){
                cm.log.d(cm.loader.mRequestGroups.length);
                cm.loader.addRequestGroup(_group);
            }, 8000);
        });
    </script>
    <script>if (location.hostname == "127.0.0.1") { document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=2"></' + 'script>') }</script>
</body>
</html>